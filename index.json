{"repository_name":"zaru_crystal","body":"zaru_crystal\n====\n[![Build Status](https://travis-ci.org/szTheory/zaru_crystal.svg?branch=master)](https://travis-ci.org/szTheory/zaru_crystal) [![Docs](https://img.shields.io/badge/docs-available-brightgreen.svg)](https://sztheory.github.io/zaru_crystal/) [![GitHub release](https://img.shields.io/github/release/szTheory/zaru_crystal.svg)](https://github.com/szTheory/zaru_crystal/releases) ![GitHub stars](https://img.shields.io/github/stars/szTheory/zaru_crystal?style=social)\n\nFilename sanitization for Crystal. This is useful when you generate filenames for downloads from user input. Port of the [Zaru gem for Ruby](https://github.com/madrobby/zaru). \n\n## Installation\n\n1. Add the dependency to your `shard.yml`:\n\n```yaml\n dependencies:\n   zaru_crystal:\n     github: szTheory/zaru_crystal\n```\n\n2. Run `shards install`\n\n## Usage\n\n```crystal\nrequire \"zaru_crystal\"\n```\n\n```crystal\nZaru.sanitize! \"  what\\ēver//wëird:user:înput:\"\n# => \"whatēverwëirduserînput\"\n```\n\nZaru takes a given filename (a string) and normalizes, filters and truncates it.\n\nIt removes the bad stuff but leaves unicode characters in place, so users can use whatever alphabets they want to. Zaru also doesn't remove whitespace– instead, any sequence of whitespace that is 1 or more characters in length is collapsed to a single space. Filenames are truncated so that they are at maximum 255 characters long.\n\nIf extra breathing room is required (for example to add your own filename extension later),\nyou can leave extra room with the `:padding` option:\n\n```crystal\nZaru.sanitize! \"A\"*400, padding: 100\n# resulting filename is 145 characters long\n```\n\nIf you need to customize the fallback filename you can add your own fallback\nwith the `:fallback` option:\n\n```crystal\nZaru.sanitize! \"<<<\", fallback: \"no_file\"\n# resulting filename is \"no_file\"\n```\n\nBad things in filenames\n-----------------------\n\nWikipedia has a [good overview on filenames](http://en.wikipedia.org/wiki/Filename). Basically, on modern-ish operating systems, the following characters  are considered no-no (Zaru filters these):\n\n```\n/ \\ ? * : | \" < >\n```\n\nAdditionally the [ASCII control characters](http://en.wikipedia.org/wiki/ASCII#ASCII_control_characters) (hexadecimal `00` to `1f`) are filtered.\n\nAll [Unicode whitespace](http://en.wikipedia.org/wiki/Whitespace_character#Unicode) at the beginning and end of the potential filename is removed, and any Unicode whitespace within the filename is collapse to a single space character.\n\n[Certain filenames are reserved in Windows](http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247%28v=vs.85%29.aspx) and are filtered.\n\n\n[Wait, what, Zaru?](http://en.wikipedia.org/wiki/Zaru)\n\n[zaru_crystal](https://github.com/szTheory/zaru_crystal) is licensed under the terms of the MIT license.","program":{"html_id":"zaru_crystal/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"zaru_crystal","program":true,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"zaru_crystal/Zaru","path":"Zaru.html","kind":"class","full_name":"Zaru","name":"Zaru","abstract":false,"superclass":{"html_id":"zaru_crystal/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"zaru_crystal/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"zaru_crystal/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/zaru.cr","line_number":1,"url":"https://github.com/szTheory/zaru_crystal/blob/d4a08e1cc030a075b139a8c0b5ab4b8651450eae/src/zaru.cr#L1"}],"repository_name":"zaru_crystal","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"CHARACTER_FILTER","name":"CHARACTER_FILTER","value":"/[\\x00-\\x1F\\/\\\\:\\*\\?\\\"<>\\|]/i","doc":null,"summary":null},{"id":"FALLBACK_FILENAME","name":"FALLBACK_FILENAME","value":"\"file\"","doc":null,"summary":null},{"id":"UNICODE_WHITESPACE","name":"UNICODE_WHITESPACE","value":"/[[:space:]]+/i","doc":null,"summary":null},{"id":"VERSION","name":"VERSION","value":"\"0.1.0\"","doc":null,"summary":null},{"id":"WINDOWS_RESERVED_NAMES","name":"WINDOWS_RESERVED_NAMES","value":"[\"CON\", \"PRN\", \"AUX\", \"NUL\", \"COM1\", \"COM2\", \"COM3\", \"COM4\", \"COM5\", \"COM6\", \"COM7\", \"COM8\", \"COM9\", \"LPT1\", \"LPT2\", \"LPT3\", \"LPT4\", \"LPT5\", \"LPT6\", \"LPT7\", \"LPT8\", \"LPT9\"] of ::String","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[{"id":"sanitize!(filename,fallback=nil,padding=nil)-class-method","html_id":"sanitize!(filename,fallback=nil,padding=nil)-class-method","name":"sanitize!","doc":"convenience method","summary":"<p>convenience method</p>","abstract":false,"args":[{"name":"filename","doc":null,"default_value":"","external_name":"filename","restriction":""},{"name":"fallback","doc":null,"default_value":"nil","external_name":"fallback","restriction":""},{"name":"padding","doc":null,"default_value":"nil","external_name":"padding","restriction":""}],"args_string":"(filename, fallback = <span class=\"n\">nil</span>, padding = <span class=\"n\">nil</span>)","args_html":"(filename, fallback = <span class=\"n\">nil</span>, padding = <span class=\"n\">nil</span>)","location":{"filename":"src/zaru.cr","line_number":53,"url":"https://github.com/szTheory/zaru_crystal/blob/d4a08e1cc030a075b139a8c0b5ab4b8651450eae/src/zaru.cr#L53"},"def":{"name":"sanitize!","args":[{"name":"filename","doc":null,"default_value":"","external_name":"filename","restriction":""},{"name":"fallback","doc":null,"default_value":"nil","external_name":"fallback","restriction":""},{"name":"padding","doc":null,"default_value":"nil","external_name":"padding","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(new(filename, fallback, padding)).to_s"}}],"constructors":[{"id":"new(filename,fallback,padding)-class-method","html_id":"new(filename,fallback,padding)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"filename","doc":null,"default_value":"","external_name":"filename","restriction":""},{"name":"fallback","doc":null,"default_value":"","external_name":"fallback","restriction":""},{"name":"padding","doc":null,"default_value":"","external_name":"padding","restriction":""}],"args_string":"(filename, fallback, padding)","args_html":"(filename, fallback, padding)","location":{"filename":"src/zaru.cr","line_number":17,"url":"https://github.com/szTheory/zaru_crystal/blob/d4a08e1cc030a075b139a8c0b5ab4b8651450eae/src/zaru.cr#L17"},"def":{"name":"new","args":[{"name":"filename","doc":null,"default_value":"","external_name":"filename","restriction":""},{"name":"fallback","doc":null,"default_value":"","external_name":"fallback","restriction":""},{"name":"padding","doc":null,"default_value":"","external_name":"padding","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(filename, fallback, padding)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"normalize-instance-method","html_id":"normalize-instance-method","name":"normalize","doc":"strip whitespace on beginning and end\ncollapse intra-string whitespace into single spaces","summary":"<p>strip whitespace on beginning and end collapse intra-string whitespace into single spaces</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/zaru.cr","line_number":26,"url":"https://github.com/szTheory/zaru_crystal/blob/d4a08e1cc030a075b139a8c0b5ab4b8651450eae/src/zaru.cr#L26"},"def":{"name":"normalize","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@raw.strip.gsub(UNICODE_WHITESPACE, \" \")"}},{"id":"sanitize-instance-method","html_id":"sanitize-instance-method","name":"sanitize","doc":"remove bad things!\n- remove characters that aren't allowed cross-OS\n- don't allow certain special filenames (issue on Windows)\n- don't allow filenames to start with a dot\n- don't allow empty filenames\n\nthis renormalizes after filtering in order to collapse whitespace","summary":"<p>remove bad things! - remove characters that aren't allowed cross-OS - don't allow certain special filenames (issue on Windows) - don't allow filenames to start with a dot - don't allow empty filenames</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/zaru.cr","line_number":37,"url":"https://github.com/szTheory/zaru_crystal/blob/d4a08e1cc030a075b139a8c0b5ab4b8651450eae/src/zaru.cr#L37"},"def":{"name":"sanitize","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(filter(normalize.gsub(CHARACTER_FILTER, \"\"))).gsub(UNICODE_WHITESPACE, \" \")"}},{"id":"to_s-instance-method","html_id":"to_s-instance-method","name":"to_s","doc":"Returns a string representation of this object.\n\nDescendants must usually **not** override this method. Instead,\nthey must override `to_s(io)`, which must append to the given\nIO object.","summary":"<p>Returns a string representation of this object.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/zaru.cr","line_number":48,"url":"https://github.com/szTheory/zaru_crystal/blob/d4a08e1cc030a075b139a8c0b5ab4b8651450eae/src/zaru.cr#L48"},"def":{"name":"to_s","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"truncate"}},{"id":"truncate-instance-method","html_id":"truncate-instance-method","name":"truncate","doc":"cut off at 255 characters\noptionally provide a padding, which is useful to\nmake sure there is room to add a file extension later","summary":"<p>cut off at 255 characters optionally provide a padding, which is useful to make sure there is room to add a file extension later</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/zaru.cr","line_number":44,"url":"https://github.com/szTheory/zaru_crystal/blob/d4a08e1cc030a075b139a8c0b5ab4b8651450eae/src/zaru.cr#L44"},"def":{"name":"truncate","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"sanitize.chars.to_a[0..(254 - @padding)].join"}}],"macros":[],"types":[]}]}}